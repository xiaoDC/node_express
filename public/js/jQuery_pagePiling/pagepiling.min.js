define(function(a,b,c){var d=a("$");d.fn.pagepiling=function(a){function b(a){a.addClass("pp-table").wrapInner('<div class="pp-tableCell" />')}function c(a){var b=d(".pp-section.active").index(".pp-section"),c=a.index(".pp-section");return b>c?"up":"down"}function e(b,e){var g={destination:b,animated:e,activeSection:d(".pp-section.active"),anchorLink:b.data("anchor"),sectionIndex:b.index(".pp-section"),toMove:b,yMovement:c(b),leavingSection:d(".pp-section.active").index(".pp-section")+1};if(!g.activeSection.is(b)){"undefined"==typeof g.animated&&(g.animated=!0),"undefined"!=typeof g.anchorLink&&k(g.anchorLink),g.destination.addClass("active").siblings().removeClass("active"),g.sectionsToMove=h(g),"down"===g.yMovement?(g.translate3d=G(),g.scrolling="-100%",a.css3||g.sectionsToMove.each(function(a){a!=g.activeSection.index(".pp-section")&&d(this).css(j(g.scrolling))}),g.animateSection=g.activeSection):(g.translate3d="translate3d(0px, 0px, 0px)",g.scrolling="0",g.animateSection=b),d.isFunction(a.onLeave)&&a.onLeave.call(this,g.leavingSection,g.sectionIndex+1,g.yMovement),f(g),E(g.anchorLink),D(g.anchorLink,g.sectionIndex),H=g.anchorLink;var i=(new Date).getTime();J=i}}function f(b){a.css3?(p(b.animateSection,b.translate3d,b.animated),b.sectionsToMove.each(function(){p(d(this),b.translate3d,b.animated)}),setTimeout(function(){g(b)},a.scrollingSpeed)):(b.scrollOptions=j(b.scrolling),b.animated?b.animateSection.animate(b.scrollOptions,a.scrollingSpeed,a.easing,function(){i(b),g(b)}):(b.animateSection.css(j(b.scrolling)),setTimeout(function(){i(b),g(b)},400)))}function g(b){d.isFunction(a.afterLoad)&&a.afterLoad.call(this,b.anchorLink,b.sectionIndex+1)}function h(a){var b;return b=d(".pp-section").map("down"===a.yMovement?function(b){return b<a.destination.index(".pp-section")?d(this):void 0}:function(b){return b>a.destination.index(".pp-section")?d(this):void 0})}function i(a){var b;return"up"===a.yMovement&&a.sectionsToMove.each(function(){d(this).css(j(a.scrolling))}),b}function j(b){return"vertical"===a.direction?{top:b}:{left:b}}function k(b){a.anchors.length&&(location.hash=b)}function l(){var b=window.location.hash.replace("#",""),c=b,f=d('.pp-section[data-anchor="'+c+'"]');f.length>0&&e(f,a.animateAnchor)}function m(){var b=(new Date).getTime();return b-J<M+a.scrollingSpeed?!0:!1}function n(){var a=window.location.hash.replace("#","").split("/"),b=a[0];if(b.length){if(b&&b!==H){if(isNaN(b))var c=d('[data-anchor="'+b+'"]');else var c=d(".pp-section").eq(b-1);e(c)}}}function o(a){return{"-webkit-transform":a,"-moz-transform":a,"-ms-transform":a,transform:a}}function p(a,b,c){a.toggleClass("pp-easing",c),a.css(o(b))}function q(a){if(!m()){a=window.event||a;var b=Math.max(-1,Math.min(1,a.wheelDelta||-a.deltaY||-a.detail)),c=d(".pp-section.active"),e=s(c);return 0>b?r("down",e):r("up",e),!1}}function r(a,b){if("down"==a)var c="bottom",e=d.fn.pagepiling.moveSectionDown;else var c="top",e=d.fn.pagepiling.moveSectionUp;if(b.length>0){if(!isScrolled(c,b))return!0;e()}else e()}function s(a){return scrollable=a.find(".pp-scrollable")}function t(){I.get(0).addEventListener?(I.get(0).removeEventListener("mousewheel",q,!1),I.get(0).removeEventListener("wheel",q,!1)):I.get(0).detachEvent("onmousewheel",q)}function u(){I.get(0).addEventListener?(I.get(0).addEventListener("mousewheel",q,!1),I.get(0).addEventListener("wheel",q,!1)):I.get(0).attachEvent("onmousewheel",q)}function v(){K&&(MSPointer=x(),I.off("touchstart "+MSPointer.down).on("touchstart "+MSPointer.down,z),I.off("touchmove "+MSPointer.move).on("touchmove "+MSPointer.move,A))}function w(){K&&(MSPointer=x(),I.off("touchstart "+MSPointer.down),I.off("touchmove "+MSPointer.move))}function x(){var a;return a=window.PointerEvent?{down:"pointerdown",move:"pointermove",up:"pointerup"}:{down:"MSPointerDown",move:"MSPointerMove",up:"MSPointerUp"}}function y(a){var b=new Array;return window.navigator.msPointerEnabled?(b.y=a.pageY,b.x=a.pageX):(b.y=a.touches[0].pageY,b.x=a.touches[0].pageX),b}function z(a){var b=a.originalEvent,c=y(b);L=c.y,touchStartX=c.x}function A(b){var c=b.originalEvent;if(!B(b.target)){b.preventDefault();var e=d(".pp-section.active"),f=s(e);if(!m()){var g=y(c);touchEndY=g.y,touchEndX=g.x,"horizontal"===a.direction&&Math.abs(touchStartX-touchEndX)>Math.abs(L-touchEndY)?Math.abs(touchStartX-touchEndX)>I.width()/100*a.touchSensitivity&&(touchStartX>touchEndX?r("down",f):touchEndX>touchStartX&&r("up",f)):Math.abs(L-touchEndY)>I.height()/100*a.touchSensitivity&&(L>touchEndY?r("down",f):touchEndY>L&&r("up",f))}}}function B(b,c){c=c||0;var e=d(b).parent();return c<a.normalScrollElementTouchThreshold&&e.is(a.normalScrollElements)?!0:c==a.normalScrollElementTouchThreshold?!1:B(e,++c)}function C(){}function D(b,c){a.navigation&&(d("#pp-nav").find(".active").removeClass("active"),b?d("#pp-nav").find('a[href="#'+b+'"]').addClass("active"):d("#pp-nav").find("li").eq(c).find("a").addClass("active"))}function E(b){a.menu&&(d(a.menu).find(".active").removeClass("active"),d(a.menu).find('[data-menuanchor="'+b+'"]').addClass("active"))}function F(){var a,b=document.createElement("p"),c={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(b,null);for(var d in c)void 0!==b.style[d]&&(b.style[d]="translate3d(1px,1px,1px)",a=window.getComputedStyle(b).getPropertyValue(c[d]));return document.body.removeChild(b),void 0!==a&&a.length>0&&"none"!==a}function G(){return"vertical"!==a.direction?"translate3d(-100%, 0px, 0px)":"translate3d(0px, -100%, 0px)"}var H,I=d(this),J=0,K="ontouchstart"in window||navigator.msMaxTouchPoints>0,L=touchStartX=touchEndY=touchEndX=0,M=600;a=d.extend({direction:"vertical",menu:null,verticalCentered:!0,sectionsColor:[],anchors:[],scrollingSpeed:700,easing:"swing",loopBottom:!1,loopTop:!1,css3:!0,navigation:{textColor:"#000",bulletsColor:"#000",position:"right",tooltips:["section1","section2","section3","section4"]},normalScrollElements:null,normalScrollElementTouchThreshold:5,touchSensitivity:5,keyboardScrolling:!0,sectionSelector:".section",animateAnchor:!1,afterLoad:null,onLeave:null,afterRender:null},a),d.fn.pagepiling.setScrollingSpeed=function(b){a.scrollingSpeed=b},d.fn.pagepiling.setMouseWheelScrolling=function(a){a?u():t()},d.fn.pagepiling.setAllowScrolling=function(a){a?(d.fn.pagepiling.setMouseWheelScrolling(!0),v()):(d.fn.pagepiling.setMouseWheelScrolling(!1),w())},d.fn.pagepiling.setKeyboardScrolling=function(b){a.keyboardScrolling=b},d.fn.pagepiling.moveSectionUp=function(){var b=d(".pp-section.active").prev(".pp-section");!b.length&&a.loopTop&&(b=d(".pp-section").last()),b.length&&e(b)},d.fn.pagepiling.moveSectionDown=function(){var b=d(".pp-section.active").next(".pp-section");!b.length&&a.loopBottom&&(b=d(".pp-section").first()),b.length&&e(b)},d.fn.pagepiling.moveTo=function(a){var b="";b=isNaN(a)?d('[data-anchor="'+a+'"]'):d(".pp-section").eq(a-1),b.length>0&&e(b)},d(a.sectionSelector).each(function(){d(this).addClass("pp-section")}),a.css3&&(a.css3=F()),d(I).css({overflow:"hidden","-ms-touch-action":"none","touch-action":"none"}),d.fn.pagepiling.setAllowScrolling(!0),d.isEmptyObject(a.navigation)||C();var N=d(".pp-section").length;d(".pp-section").each(function(c){d(this).data("data-index",c),d(this).css("z-index",N),c||0!==d(".pp-section.active").length||d(this).addClass("active"),"undefined"!=typeof a.anchors[c]&&d(this).attr("data-anchor",a.anchors[c]),"undefined"!=typeof a.sectionsColor[c]&&d(this).css("background-color",a.sectionsColor[c]),a.verticalCentered&&b(d(this)),N-=1}).promise().done(function(){a.navigation&&(d("#pp-nav").css("margin-top","-"+d("#pp-nav").height()/2+"px"),d("#pp-nav").find("li").eq(d(".pp-section.active").index(".pp-section")).find("a").addClass("active")),d(window).on("load",function(){l()}),d.isFunction(a.afterRender)&&a.afterRender.call(this)}),d(window).on("hashchange",n),d(document).keydown(function(b){if(a.keyboardScrolling&&!m())switch(b.which){case 38:case 33:d.fn.pagepiling.moveSectionUp();break;case 40:case 34:d.fn.pagepiling.moveSectionDown();break;case 36:d.fn.pagepiling.moveTo(1);break;case 35:d.fn.pagepiling.moveTo(d(".pp-section").length);break;case 37:d.fn.pagepiling.moveSectionUp();break;case 39:d.fn.pagepiling.moveSectionDown();break;default:return}}),a.normalScrollElements&&(d(document).on("mouseenter",a.normalScrollElements,function(){d.fn.pagepiling.setMouseWheelScrolling(!1)}),d(document).on("mouseleave",a.normalScrollElements,function(){d.fn.pagepiling.setMouseWheelScrolling(!0)})),d(document).on("click touchstart","#pp-nav a",function(a){a.preventDefault();var b=d(this).parent().index();e(d(".pp-section").eq(b))}),d(document).on({mouseenter:function(){var b=d(this).data("tooltip");d('<div class="pp-tooltip '+a.navigation.position+'">'+b+"</div>").hide().appendTo(d(this)).fadeIn(200)},mouseleave:function(){d(this).find(".pp-tooltip").fadeOut(200,function(){d(this).remove()})}},"#pp-nav li")},c.exports=d.fn.pagepiling});